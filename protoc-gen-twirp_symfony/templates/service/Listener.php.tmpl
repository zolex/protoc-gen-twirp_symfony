<?php
# Generated by the protocol buffers compiler.  DO NOT EDIT! (protoc-gen-twirp_symfony 0.8.1)
# source: {{ .File.Proto.Name }}

declare(strict_types=1);

namespace {{ .File | phpNamespace }};

use Google\Protobuf\Internal\Message;
use Modix\TwirpBundle\EventListener\AbstractServiceListener;
use Modix\TwirpBundle\Twirp\ServiceInterface;

/**
 * @see {{ .Service | phpServiceName .File }}
 *
 * Generated from protobuf service <code>{{ .Service.Desc.Name }}</code>
 */
final class {{ .Service | phpServiceName .File }}EventSubscriber extends AbstractServiceHandler
{
    /**
     * @param {{ .Service | phpServiceName .File }}Interface $service
     * @param string $prefix
     * @param string $packageName
     * @param string $serviceName
     */
    public function __construct(
        private readonly {{ .Service | phpServiceName .File }}Interface $service,
        protected readonly string $prefix = '/twirp',
        protected readonly ?string $packageName = '{{ .File.Proto.GetPackage }}',
        protected readonly string $serviceName = '{{ .Service.Desc.Name }}'
    ) {
    }

    /**
     * @return {{ .Service | phpServiceName .File }}Interface
     */
    protected function getService(): ServiceInterface
    {
        return $this->service;
    }

    /**
     * @param string $method
     *
     * @return Message|null
     */
    public function messageFactory(string $method): ?Message
    {
        return match ($method) {
{{- range $method := .Service.Methods }}
    {{- $inputType := $method.Input | phpMessageName $.File }}
            '{{ $method | protoMethodShortName }}' => new {{ $inputType }}(),
{{- end }}
            default => null,
        };
    }

    /**
     * @param string $method
     * @param array $ctx
     * @param Message $input
     *
     * @return Message|null
     */
    public function callMethod(string $method, array $ctx, Message $input): ?Message
    {
        return match ($method) {
{{- range $method := .Service.Methods }}
            '{{ $method | protoMethodShortName }}' => $this->service->{{ $method | protoMethodShortName }}($ctx, $input),
{{- end }}
            default => null,
        };
    }
}
